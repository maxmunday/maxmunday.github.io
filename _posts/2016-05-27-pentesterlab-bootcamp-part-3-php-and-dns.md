---
layout: post
title: "PentesterLab Bootcamp - PHP and DNS"
date: 2016-05-27
description: "Walk-through guide to PentesterLab's bootcamp."
number: "0x05"
---
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

This is part 3 of my write-up of PentesterLab's [Bootcamp](https://pentesterlab.com/bootcamp) course. If you see any errors or want to suggest I do something different, please [contact me](https://www.maxmunday.com/contact/) to let me know.

Write-up parts [1](https://www.maxmunday.com/blog/2016/05/14/pentesterlab-bootcamp-part-1-linux-and-scripting), [2](https://www.maxmunday.com/blog/2016/05/22/pentesterlab-bootcamp-part-2-http), [3](https://www.maxmunday.com/blog/2016/05/27/pentesterlab-bootcamp-part-3-php-and-dns), [4](https://www.maxmunday.com/blog/2016/08/09/pentesterlab-bootcamp-part-4-ssl-tls), [5.1](https://www.maxmunday.com/blog/2017/01/04/pentesterlab-bootcamp-part-5.1-sql-injection), [5.2](https://www.maxmunday.com/blog/2017/01/18/pentesterlab-bootcamp-part-5.2-local-file-include), [6](https://www.maxmunday.com/blog/2017/07/19/pentesterlab-bootcamp-part-6-more-sql-injection).

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

<pre>
                   * * * [ DISCLAIMER ] * * *
/*
 * All information in this write-up is, to the best of my knowledge,  
 * truthful and accurate. However, I am only new to this, and I am   
 * learning as I go, so it is entirely possible something contained  
 * within this write-up is incorrect in some way. Never execute any  
 * command, without knowing for sure what it is you are doing. Look  
 * at the man pages of all commands if you do not understand them.  
 *
 * I take no responsibility if you decide to use this information   
 * to commit illegal acts. If you attempt to use these techniques  
 * against devices or networks you do not either own, or have    
 * permission to attack, you could end up in prison.  
 *
 */  
</pre>
 
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ Step 3 ]

This write-up includes some basic PHP and MySQL, and a look into basic DNS lookup tools including whois and dig.

I will go over the installtion and testing of MySQL and PHP, and then cover some basic scripts that achieve what is asked of us for this stage of the bootcamp course.

This write-up will end with a look at some of the information gathered through the DNS lookup tools.

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ Installing PHP and MySQL ]

Before installing new software packages always be sure to run an update. Once it has completed, we can install MySQL and PHP.

First MySQL:

{% highlight shell %}
$ sudo apt-get update               
$ sudo apt-get install mysql-server 
{% endhighlight %}

After this has completed, we can now install PHP, remembering to restart Apache to ensure the changes are recognised:

{% highlight shell %}
$ sudo apt-get install php libapache2-mod-php php-mcrypt php-mysql
$ sudo /etc/init.d/apache2 restart                                
{% endhighlight %}

To ensure PHP is working as intended, we will run a short info script and check it in our browser. First we create a file titled testphp.php in /var/www/html.

{% highlight shell %}
$ sudo nano /var/www/html/testphp.php
{% endhighlight %}

We then enter this simple PHP script, save and exit.

{% highlight php linenos %}
 <?php phpinfo(); ?>
{% endhighlight %}

When we navigate to localhost/testphp.php in our browser we should see this:

![](/pictures/php_info.png){:height="320px" width="517px"}

This confirms the PHP information and that it is working correctly on our system.

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ PHP Script ]

Now, we are requested to write a PHP script that echoes back a parameter in the URL. So, if we navigate to http://vulnerable/hello.php?name=Max, it should display "Hello Max" in the browser.

To achieve this I wrote this simple script.

{% highlight php linenos %}
<html>
	<head>
		<title> Hello </title>
	</head>

	<body>
	<?php

	// The value of the variable name is found
	echo "<h1>Hello " . $_GET["name"] . "</h1>";

	?>

	</body>
</html>
{% endhighlight %}

The [$_GET](http://php.net/manual/en/reserved.variables.get.php) is a [superglobal](http://php.net/manual/en/language.variables.superglobals.php) built-in variable in PHP, that, when called, passes the value of a variable that is defined in the URL. 

So then, if we access localhost/hello.php?name=Max it will result in:

![](/pictures/hello_php_1.png){:height="383px" width="575px"}

Alternatively, if we access localhost/hello.php?name=Louis it will display:

![](/pictures/hello_php_2.png){:height="383px" width="575px"}

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ MySQL ]

We will now write a script that retrives information from a MySQL database and displays that information in the browser. The data will be an image, and we will determine which image from a variable in the URL. So vulnerable/article.php?id=1 will display a landscape, and vulnerable/article.php?id=2 will display a pilot.

First we create database in MySQL called PTLBC. We do this with the following command: 

{% highlight shell %}
$ sudo mysqladmin -u root -p create PTLBC
{% endhighlight %}

We will than connect to MySQL and enter our password. Following this we will see the MySQL prompt. We then need to add a guest user. We enter the database 'mysql' where the user information is kept. We than add an additional user titled 'guest' (with password of 'guest') with enough privileges to ensure it can access the data. We will use these credentials in out PHP script to retrive our data from MySQL.

{% highlight shell %}
$ sudo mysql -u root -p                             
Enter password:*******                              
mysql> use mysql;                                   
Database changed                                    
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    -> ON PTLBC.*                                   
    -> TO 'guest'@'localhost'                       
    -> IDENTIFIED BY 'guest';                       
{% endhighlight %}

Then we want to change the active database to PTLBC in order to create a new table with our data. 

{% highlight shell %}
msql> use PTLBC;
{% endhighlight %}

We will create a table within the PTLBC database called my_images. The table will have two columns 'id' which will be a numerical value (indicated by INT), and 'image' which will be a LONGBLOB value, to allow an image to be inserted.

{% highlight shell %}
mysql> CREATE TABLE my_images(id INT, image LONGBLOB , PRIMARY KEY (id));
{% endhighlight %}

To use the [LOAD_FILE()](http://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_load-file) function you must ensure the user has [FILE](http://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_file) privilage. You must set this explicitly.

{% highlight shell %}
mysql> GRANT FILE on PTLBC.* TO guest@localhost;
{% endhighlight %}

Ensure parent directory and the files are owned by MySQL 

{% highlight shell %}
$ sudo chown mysql:mysql /var/lib/mysql-files/
{% endhighlight %}

You must also ensure that the [secure_file_priv](http://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_secure_file_priv) variable is set to the directory that contains the files you wish to export, or set with no value (as opposed to a NULL value, which has a different meaning for this variable) to disable the feature.

We can then insert the data into the table. 

{% highlight shell %}
mysql> INSERT INTO my_images (id, image) VALUES (1, LOAD_FILE('/var/lib/mysql-files/landscape.jpg'));
mysql> INSERT INTO my_images (id, image) VALUES (2, LOAD_FILE('/var/lib/mysql-files/pilot.jpg'));
{% endhighlight %}

Then we write our PHP script to retrive these images on our web page. I named it article.php, and created it in the /var/www/html/ directory so it can be accessed in the browser.

{% highlight php linenos %}
<?php
$con = mysql_connect('localhost', 'guest', 'guest');

if (!$con)
{
	die('Could not connect: ' .mysql_error());
}

mysql_select_db("PTLBC", $con);

$article_id = $_GET["id"];

$query = "SELECT `image` FROM `my_images` WHERE `id` = $article_id";

$image = mysql_query($query);

header("Content-type: image/jpg");
echo mysql_result($image, 0);

mysql_close($con);
?>
{% endhighlight %}

Then, when we navigate to vulnerable/article.php?id=1 and  vulnerable/article.php?id=2, we see the image displayed in the browser.

![](/pictures/mysql_1.png){:height="503px" width="624px"}

![](/pictures/mysql_2.png){:height="503px" width="624px"}

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ POST Request ]

We are instructed to create a page that sends data to itself using a [$_POST](http://php.net/manual/en/reserved.variables.post.php) request. POST differs to GET in that the data submited through POST is not visible in the address bar, nor the websever logs. 

{% highlight php linenos %}

<?php
if (isset($_POST['submit'])) {
	$name = $_POST['name'];
	if ( !empty($name) ) {
		echo 'Hello ',$name,'.';
	}
	else { $error = true; }
}
?>
<html>
<head>
        <title>Post to Self</title>
</head>
<body>
<form method="post" action="<?php echo $_SERVER['PHP_SELF']; ?>">
<?php
	if ($error && empty($name) ) {
		echo 'Please enter your name.<br>' ;
	}
?>
	Name: <input name="name" type="text" value="<?php echo $name; ?>">
	<br>
	<br>
	<input type="submit" name="submit" value"Submit">
</form>
</body>
</html>

{% endhighlight %}

The action attribute of the of `<form>` tag contains the PHP   
`<?php echo $_SERVER['PHP_SELF']; ?>`, which evaluates to the current web page. This, along with the `$_POST` variables in the first PHP script, effectively POSTs the data to itself.

![](/pictures/post_2.png){:height="223px" width="563px"}

If the user fails to input their name, an error message appears. This is seen in the inital PHP code that sets the value of $error to true, and the PHP code in the form that displays the error message. This allows the page to load wihout triggering the error.

![](/pictures/post_3.png){:height="223px" width="563px"}

When the data is posted, it echoes it onto the page.

![](/pictures/post_4.png){:height="223px" width="563px"}

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ DNS and whois ]

We are asked to find the name servers, mail servers, and the IP address of pentesterlab.com using the `dig` command line tool.

Running:

{% highlight shell %}
$ dig pentesterlab.com ANY
{% endhighlight %}

gives us this information:

![](/pictures/dig.png){:height="305px" width="638px"}

The name servers are listed across from 'NS', the mail servers are listed across from 'MX', and the IP address is listed as 128.199.33.20. 

Whois.net is a domain lookup service that lists details about the owner and registrar of the domain. When querying pentesterlab.com we get the following information:

![](/pictures/whois.png){:height="441px" width="474px"}

Using the `whois` commandline tool, we get essentially the same information, with some extras tacked on at the end:

![](/pictures/whois_1.png){:height="810px" width="652px"}

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

/*\*\* [Part 1 - Linux and Scripting](https://www.maxmunday.com/blog/2016/05/14/pentesterlab-bootcamp-part-1-linux-and-scripting) \*\*\*/

/*\*\* [Part 2 - HTTP](https://www.maxmunday.com/blog/2016/05/22/pentesterlab-bootcamp-part-2-http) \*\*\*/

/*\*\* [Part 4 - SSL/TLS](https://www.maxmunday.com/blog/2016/08/09/pentesterlab-bootcamp-part-4-ssl-tls) \*\*\*/

/*\*\* [Part 5.1 - SQL Injection](https://www.maxmunday.com/blog/2017/01/04/pentesterlab-bootcamp-part-5.1-sql-injection) \*\*\*/

/*\*\* [Part 5.2 - Local File Include](https://www.maxmunday.com/blog/2017/01/18/pentesterlab-bootcamp-part-5.2-local-file-include) \*\*\*/

/*\*\* [Part 6 - More SQL Injection](https://www.maxmunday.com/blog/2017/07/19/pentesterlab-bootcamp-part-6-more-sql-injection) \*\*\*/

/*\*\* Part 7- FTP and Traffic Analysis COMING SOON \*\*\*/

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
