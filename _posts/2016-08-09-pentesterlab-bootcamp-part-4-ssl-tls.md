---
layout: post
title: "PentesterLab Bootcamp Part 4 - SSL/TLS"
date: 2016-08-09
description: "Walk-through guide to PentesterLab's bootcamp."
number: "0x06"
---
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

This is part 4 of my write-up of PentesterLab's [Bootcamp](https://pentesterlab.com/bootcamp) course. If you see any errors or want to suggest I do something different, please [contact me](https://www.maxmunday.com/contact/) to let me know.

Write-up parts [1](https://www.maxmunday.com/blog/2016/05/14/pentesterlab-bootcamp-part-1-linux-and-scripting), [2](https://www.maxmunday.com/blog/2016/05/22/pentesterlab-bootcamp-part-2-http), [3](https://www.maxmunday.com/blog/2016/05/27/pentesterlab-bootcamp-part-3-php-and-dns), [4](https://www.maxmunday.com/blog/2016/08/09/pentesterlab-bootcamp-part-4-ssl-tls), [5.1](https://www.maxmunday.com/blog/2017/01/04/pentesterlab-bootcamp-part-5.1-sql-injection)


\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

<pre>
                   * * * [ DISCLAIMER ] * * *
/*
 * All information in this write-up is, to the best of my knowledge,  
 * truthful and accurate. However, I am only new to this, and I am   
 * learning as I go, so it is entirely possible something contained  
 * within this write-up is incorrect in some way. Never execute any  
 * command, without knowing for sure what it is you are doing. Look  
 * at the man pages of all commands if you do not understand them.  
 *
 * I take no responsibility if you decide to use this information   
 * to commit illegal acts. If you attempt to use these techniques  
 * against devices or networks you do not either own, or have    
 * permission to attack, you could end up in prison.  
 *
 */  
</pre>
 
\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ Step 4 ]

This step is all about SSL/TLS. We enable SSL on the apache server and write a few clients to connect to it. 

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ SSL ]

First we will enable SSL on Apache and configure it to accept only the strongest encryption. For this example I will be using a self-signed and generated certificate, obviously this is not a secure practice and you should not trust or allow self-signed certificates when browsing the internet. This is for ease of learning only

First we will create a directory to store our certificate.

~~~
sudo mkdir /etc/apache2/ssl
~~~

Now we will create a self-signed certificate.

~~~
sudo openssl req -x509 -nodes -days 1095 -newkey rsa:2048 -out /etc/apache2/ssl/server.crt -keyout /etc/apache2/ssl/server.key
~~~

\* `-x509` identifies a certificate requirement, as opposed to a request.  
\* `-days xxxx` sets the expiry date, in this case 1095 days.  
\* `-nodes` specifies no passphrase.  
\* `-rsa:2048` sets the key as a 2048 bit RSA.  
\* `-out` and `keyout` set the location for the certificate and key.

After entering the previous command you will be prompted with the following:

![](/pictures/ssl_1.png){:height="344px" width="566px"}

The details are less important with a self-signed certificate as it will kick back a warning not to be trusted regardless, however, these details must match the site to be considered secure.

Now we have to install the SSL mod for Apache, and create a symbolic link for the default-ssl in the sites-available directory.

~~~
sudo a2enmod ssl
~~~

~~~
sudo ln -s /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/000-default-ssl.conf
~~~

We then edit the file to give it the path to our SSL certificate and key which we set when we generated the certificate.

~~~
sudo nano /etc/apache2/sites-enabled/000-default-ssl.conf
~~~

![](/pictures/ssl_2.png){:height="505px" width="591px"}

We also need to ensure that the ports.conf is set to listen on port 443 for HTTPS. There should be a line that says Listen 443.

~~~
/etc/apache2/ports.conf
~~~

Lastly, we need to ensure that weak ciphers are disabled by forcing strong encryption. The method is described in the [Apache docs](https://httpd.apache.org/docs/2.4/ssl/ssl_howto.html#onlystrong).

~~~
sudo nano /etc/apache2/mods-enabled/ssl.conf
~~~

and add: 

SSLCipherSuite HIGH:!aNULL:!MD5

Then we restart the server and visit our site in HTTPS.

~~~
sudo /etc/init.d/apache2 restart
~~~

![](/pictures/ssl_3.png){:height="189px" width="466px"}

The HTTPS lock in the top left corner has the yellow ! icon signifying that it is unsecure, this is because it is a self-signed certificate and should not be trusted anyway. It is easy enough to add the certificate to the browser's trusted issuers, but the process varies for each browser.

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

\-\-[ SSL Clients ]

To write an SSL client using a HTTP library is quite straight forward after the HTTP client in a previous step. You simply need to add in the HTTPS connection. The code can be found [here](https://github.com/maxmunday/pentesterLab-bootcamp/blob/master/HTTPS_client.py).

![](/pictures/ssl_4.png){:height="471px" width="582px"}

Now, the issue with this is that the self-signed certificate will kick back a warning and will display an error when this script is run. However, the script itself works if the certificate is valid.

An SSL client script using a socket is similar to the previous socket script, but this time we import ssl and wrap the socket before connection. The script can be found [here](https://github.com/maxmunday/pentesterLab-bootcamp/blob/master/HTTPS_socket.py).

![](/pictures/ssl_5.png){:height="347px" width="508px"}

Which gives us:

![](/pictures/ssl_6.png){:height="175px" width="427px"}

This works fine as the default parameter for ssl.wrap_socket is to not require a certificate. If you want to change the parameters surrounding certificates and encryption check out the [ssl docs](https://docs.python.org/2/library/ssl.html).

Finally, we will access the SSL server with the previous HTTP script and use socat to do the connection. 

![](/pictures/socat_1.png){:height="273px" width="600px"}

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-

/*\*\* [Part 1 - Linux and Scripting](https://www.maxmunday.com/blog/2016/05/14/pentesterlab-bootcamp-part-1-linux-and-scripting) \*\*\*/

/*\*\* [Part 2 - HTTP](https://www.maxmunday.com/blog/2016/05/22/pentesterlab-bootcamp-part-2-http) \*\*\*/

/*\*\* [Part 3 - PHP and DNS](https://www.maxmunday.com/blog/2016/05/27/pentesterlab-bootcamp-part-3-php-and-dns) \*\*\*/

/*\*\* [Part 5.1 - SQL Injection](https://www.maxmunday.com/blog/2017/01/04/pentesterlab-bootcamp-part-5.1-sql-injection) \*\*\*/

/*\*\* Part 5.2 - Local File Include COMING SOON \*\*\*/

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-
